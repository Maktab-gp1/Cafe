{% extends 'dashboard/dashboard_base.html' %}
{% block body %}
{% load static %}

<!--  BEGIN MAIN CONTAINER  -->
    <div class="main-container sidebar-closed sbar-open" id="container">

        <div class="overlay"></div>
        <div class="search-overlay"></div>        
        {% include 'dashboard/sidebar.html' %}

        <!--  BEGIN CONTENT AREA  -->
        <div id="content" class="main-content">
            <div class="layout-px-spacing">
        <div class="col-12 mb-4">
            <div class="card bg-yellow-100 border-0 shadow">
                <div class="card-header d-sm-flex flex-row align-items-center flex-0">
                    <div class="d-block mb-3 mb-sm-0">
                        <div class="fs-5 fw-normal mb-2">Sales Value</div>
                        <h2 class="fs-3 fw-extrabold">${{ total_sales|floatformat:2 }}</h2>
                        <div class="small mt-2">
                            <span class="fw-normal me-2">Diff:</span>
                            {% if percentage_difference > 0  %}
                                <span class="text-success fw-bold">{{ percentage_difference|floatformat }}%</span>
                            {% else %}
                                <span class="text-danger fw-bold">{{ percentage_difference|floatformat }}%</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="d-flex ms-auto">
                        <a href="?range=total" class=" btn btn-github text-dark btn-sm me-2">Total</a>
                        <a href="?range=year" class=" btn btn-paypal text-dark btn-sm me-2">Year</a>
                        <a href="?range=month" class="btn btn-instagram text-dark btn-sm me-2">Month</a>
                        <a href="?range=week" class="btn btn-twitch btn-sm me-2">Week</a>
                        <a href="?range=day" class="btn btn-info btn-sm me-2">Day</a>
                    </div>
                    
                </div>
            </div>
        </div>

    <div class="mx-5 mx-lg-12 row my-4 justify-content-between">
    <form method="get" action="" class="row justify-content-between">
        <div class="col-5">
            <label for="start_date">Start at:</label>
            <div class="input-group">
                        <span class="input-group-text">
                            <svg class="icon icon-xs" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path></svg>
                        </span>
                <input data-datepicker="" class="form-control" id="start_date"  name="start_date" type="text" placeholder="dd/mm/yyyy" required>
            </div>
        </div>
        <div class="col-5">
            <label for="end_date">End at:</label>
            <div class="input-group">
                        <span class="input-group-text">
                            <svg class="icon icon-xs" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path></svg>
                        </span>
                <input data-datepicker="" class="form-control" id="end_date" name="end_date"  type="text" placeholder="dd/mm/yyyy" required>
            </div>
        </div>
        <button type="submit" class="btn btn-reddit my-3 btn-sm d-inline">Filter</button>
    </form>
    </div>
    </div>

     <div class="row mx-5 mx-lg-12">
        <div class="col-12 col-xl-12">
            <div class="row">
                <div class="col-12 mb-4">
                    <div class="card border-0 shadow">
                        <div class="card-header">
                            <div class="row align-items-center">
                                <div class="col">
                                    <h2 class="fs-5 fw-bold mb-0">Favorite Foods</h2>
                                </div>

                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table align-items-center table-flush">
                                <thead class="thead-light">
                                <tr>
                                    <th class="border-bottom" scope="col">Food name</th>
                                    <th class="border-bottom" scope="col">Food Sales</th>
                                    <th class="border-bottom" scope="col">Food Counts</th>
                                    <th class="border-bottom" scope="col">Food Category</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for food in favorite_food %}



                                    <tr>
                                        <th class="text-gray-900" scope="row">
                                            <a href="">
                                                {{ food.name }}
                                            </a>
                                        </th>
                                        <td class="fw-bolder text-gray-500">
                                            {{ food.total_sales|floatformat:2 }}
                                        </td>
                                        <td class="fw-bolder text-gray-500">
                                            {{ food.counts }}
                                        </td>
                                        <td class="fw-bolder text-gray-500">
                                            {{ food.category }}
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 mb-4">
                <div class="card border-0 shadow">
                    <div class="card-header">
                        <div class="row align-items-center">
                            <div class="col">
                                <h2 class="fs-5 fw-bold mb-0">Favorite Categories</h2>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table align-items-center table-flush">
                            <thead class="thead-light">
                            <tr>
                                <th class="border-bottom" scope="col">Category Name</th>
                                <th class="border-bottom" scope="col">Category Total</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for category in favorite_category %}

                                <tr>
                                    <th class="text-white" scope="row">
                                        {{ category.name }}
                                    </th>
                                    <td class="fw-bolder text-gray-500">
                                        {{ category.total_sales|floatformat:2 }}
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>   

             <div class="col-12 mb-4">
                <div class="card border-0 shadow">
                    <div class="card-header">
                        <div class="row align-items-center">
                            <div class="col">
                                <h2 class="fs-5 fw-bold mb-0">Favorite Tables</h2>
                            </div>

                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table align-items-center table-flush">
                            <thead class="thead-light">
                            <tr>
                                <th class="border-bottom" scope="col">Table Number</th>
                                <th class="border-bottom" scope="col">Table Seats</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for table in favorite_table %}



                                <tr>
                                    <th class="text-white" scope="row">
                                        {{ table.id }}
                                    </th>
                                    <td class="fw-bolder text-gray-500">
                                        {{ table.used_seats }}
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>



            <div class="col-12 mb-4">
                <div class="card border-0 shadow">
                    <div class="card-header">
                        <div class="row align-items-center">
                            <div class="col">
                                <h2 class="fs-5 fw-bold mb-0">Status</h2>
                            </div>

                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table align-items-center table-flush">
                            <thead class="thead-light">
                            <tr>
                                <th class="border-bottom" scope="col">Status</th>
                                <th class="border-bottom" scope="col">Orders Count</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for orders in order_status_counts %}



                                <tr>
                                    <th class="text-white" scope="row">
                                        {{ orders.status_display }}
                                    </th>
                                    <td class="fw-bolder text-gray-500">
                                        {{ orders.count }}
                                    </td>

                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <h3 class="mx-5 mx-lg-12 px-5"> Peak Hours</h3>
    <div class="line-chart-filled mx-5 mx-lg-12"></div>






    <div class="row mx-5 mx-lg-12 flex-row justify-content-center">
        <div class="col-12 col-sm-12 col-xl-6 mb-4 ">
            <div class="card border-0 shadow">
                <div class="card-body">
                    <div class="row d-block d-xl-flex align-items-center">
                        <div class="col-12 col-xl-5 text-xl-center mb-3 mb-xl-0 d-flex align-items-center justify-content-xl-center">
                            <a href="">
                                <div class="icon-shape icon-shape-primary rounded me-4 me-sm-0">
                                    <svg class="icon" fill="currentColor" viewBox="0 0 20 20"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"></path>
                                    </svg>
                                </div>
                            </a>
                            <div class="d-sm-none">
                                <h2 class="h5">Best Customer</h2>
                                <h5 class="fw-extrabold mb-1">{{ best_cutomer }}</h5>
                            </div>
                        </div>
                        <div class="col-12 col-xl-7 px-xl-0">
                            <div class="d-none d-sm-block">
                                <h2 class="h6 text-gray-400 mb-0 text-center my-2">Best Customer</h2>
                                <a href=""><h5
                                        class="fw-extrabold mb-2 text-center mt-4">{{ best_cutomer }}</h5></a>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="col-12 col-sm-12 col-xl-6 mb-4 ">
            <div class="card border-0 shadow">
                <div class="card-body">
                    <div class="row d-block d-xl-flex align-items-center">
                        <div class="col-12 col-xl-5 text-xl-center mb-3 mb-xl-0 d-flex align-items-center justify-content-xl-center">
                            <div class="icon-shape icon-shape-tertiary rounded me-4 me-sm-0">
                                <svg class="icon" fill="currentColor" viewBox="0 0 20 20"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd"
                                          d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 0l-2 2a1 1 0 101.414 1.414L8 10.414l1.293 1.293a1 1 0 001.414 0l4-4z"
                                          clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="d-sm-none">
                                <h2 class="h5">Peak Hour</h2>
                                <h5 class="fw-extrabold mb-1">{{ most_peak_hour }}</h5>
                            </div>
                        </div>
                        <div class="col-12 col-xl-7 px-xl-0">
                            <div class="d-none d-sm-block">
                                <h2 class="h6 text-gray-400 mb-0 text-center my-2">Peak Hour</h2>
                                <h5 class="fw-extrabold mb-2 text-center mt-4">{{ most_peak_hour }}</h5>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>



    </div>
    {% if peak_day is not None %}
        <h3 class="mx-5 mx-lg-12 px-4"> Peak Weak</h3>
        <div class="bar-chart mx-5 mx-lg-12"></div>
    {% endif %}
            

                    
        <!--  END CONTENT AREA  -->


<script>
        // Initialize empty arrays
        var labels = [];
        var series = [];

        {% for hour_data in peak_hour %}
            labels.push('{{ hour_data.hour_range }}');
            series.push({{ hour_data.order_count }});
        {% endfor %}

        new Chartist.Line('.line-chart-filled', {
            labels: labels,
            series: [series]
        }, {
            low: 0,
            showArea: true
        });
</script>

    <script>
        var labels = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        var series = Array(7).fill(0);  // Initialize series with zeros for each day

        {% for day_data in peak_day %}
            // Convert day_of_week to 0-based index (1 for Monday, 2 for Tuesday, ..., 7 for Sunday)
            var dayIndex = {{ day_data.day_of_week }} - 1;

            // Update the series value for the corresponding day
            series[dayIndex] = {{ day_data.order_count }};
        {% endfor %}

        new Chartist.Bar('.bar-chart', {
            labels: labels,
            series: [series]
        }, {
            low: 0,
            showArea: true,
            plugins: [Chartist.plugins.tooltip()],
            axisX: {
                position: 'end'
            },
            axisY: {
                showGrid: true,
                showLabel: true,
                offset: 0
            }
        });
    </script>
    
    <script>
    var datepickers = [].slice.call(document.querySelectorAll('[data-datepicker]'))
    var datepickersList = datepickers.map(function (el) {
        return new Datepicker(el, {
            buttonClass: 'btn'
        });
    });</script>

 <!--   Core JS Files   -->
 <script src="{% static 'assets/vendor/chartist/dist/chartist.min.js' %}"></script>
 <script src="{% static 'assets/vendor/chartist-plugin-tooltips/dist/chartist-plugin-tooltip.min.js' %}"></script>
  <script src="{% static 'js/core/popper.min.js' %}" type="text/javascript"></script>
  <script src="{% static 'js/core/bootstrap.min.js' %}" type="text/javascript"></script>
  <script src="{% static 'js/plugins/perfect-scrollbar.min.js' %}"></script>
  <!--  Plugin for Parallax, full documentation here: https://github.com/wagerfield/parallax  -->
  <script src="{% static 'js/plugins/parallax.min.js' %}"></script>
  <!-- Control Center for Material UI Kit: parallax effects, scripts for the example pages etc -->
  <!--  Google Maps Plugin    -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDTTfWur0PDbZWPr7Pmq8K3jiDp0_xUziI"></script>
  <script src="{% static 'js/material-kit.min.js' %}" type="text/javascript"></script>



{% endblock body %}